<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - classlib/Streams/Stream.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome-ie7.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>classlib/Streams/Stream.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">136.81</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">568</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">44.46</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">4.73</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">SCScript.install(function(sc) {
  &quot;use strict&quot;;

  require(&quot;../Core/AbstractFunction&quot;);

  var $  = sc.lang.$;
  var fn = sc.lang.fn;
  var klass = sc.lang.klass;

  klass.define(&quot;Stream : AbstractFunction&quot;, function(spec, utils) {
    var $nil   = utils.$nil;
    var $true  = utils.$true;
    var $false = utils.$false;
    var $int_0 = utils.$int_0;
    var SCArray = $(&quot;Array&quot;);

    spec.constructor = function SCStream() {
      this.__super__(&quot;AbstractFunction&quot;);
    };

    spec.parent = function() {
      return $nil;
    };

    spec.next = function() {
      return this._subclassResponsibility(&quot;next&quot;);
    };

    spec.iter = utils.nop;

    spec.value = fn(function($inval) {
      return this.next($inval);
    }, &quot;inval&quot;);

    spec.valueArray = function() {
      return this.next();
    };

    spec.nextN = fn(function($n, $inval) {
      var $this = this;
      return SCArray.fill($n, $.Function(function() {
        return [ function() {
          return $this.next($inval);
        } ];
      }));
    }, &quot;n; inval&quot;);

    spec.all = fn(function($inval) {
      var $array;

      $array = $nil;
      this.do($.Function(function() {
        return [ function($item) {
          $array = $array.add($item);
        } ];
      }), $inval);

      return $array;
    }, &quot;inval&quot;);

    spec.put = function() {
      return this._subclassResponsibility(&quot;put&quot;);
    };

    spec.putN = fn(function($n, $item) {
      var $this = this;
      $n.do($.Function(function() {
        return [ function() {
          $this.put($item);
        } ];
      }));
      return this;
    }, &quot;n; item&quot;);

    spec.putAll = fn(function($aCollection) {
      var $this = this;
      $aCollection.do($.Function(function() {
        return [ function($item) {
          $this.put($item);
        } ];
      }));
      return this;
    }, &quot;aCollection&quot;);

    spec.do = fn(function($function, $inval) {
      var $this = this;
      var $item, $i;

      $i = $int_0;
      $.Function(function() {
        return [ function() {
          $item = $this.next($inval);
          return $item.notNil();
        } ];
      }).while($.Function(function() {
        return [ function() {
          $function.value($item, $i);
          $i = $i.__inc__();
          return $i;
        } ];
      }));

      return this;
    }, &quot;function; inval&quot;);

    spec.subSample = fn(function($offset, $skipSize) {
      var $this = this;
      var SCRoutine = $(&quot;Routine&quot;);

      return SCRoutine.new($.Function(function() {
        return [ function() {
          $offset.do($.Function(function() {
            return [ function() {
              $this.next();
            } ];
          }));
          $.Function(function() {
            return [ function() {
              $this.next().yield();
              $skipSize.do($.Function(function() {
                return [ function() {
                  $this.next();
                } ];
              }));
            } ];
          }).loop();
        } ];
      }));
    }, &quot;offset=0; skipSize=0&quot;);

    spec.generate = fn(function($function) {
      var $this = this;
      var $item, $i;

      $i = $int_0;
      $.Function(function() {
        return [ function() {
          $item = $this.next($item);
          return $item.notNil();
        } ];
      }).while($.Function(function() {
        return [ function() {
          $function.value($item, $i);
          $i = $i.__inc__();
          return $i;
        } ];
      }));

      return this;
    }, &quot;function&quot;);

    spec.collect = fn(function($argCollectFunc) {
      var $this = this;
      var $nextFunc, $resetFunc;

      $nextFunc = $.Function(function() {
        return [ function($inval) {
          var $nextval;

          $nextval = $this.next($inval);
          if ($nextval !== $nil) {
            return $argCollectFunc.value($nextval, $inval);
          }
          return $nil;
        } ];
      });
      $resetFunc = $.Function(function() {
        return [ function() {
          return $this.reset();
        } ];
      });

      return $(&quot;FuncStream&quot;).new($nextFunc, $resetFunc);
    }, &quot;argCollectFunc&quot;);

    spec.reject = fn(function($function) {
      var $this = this;
      var $nextFunc, $resetFunc;

      $nextFunc = $.Function(function() {
        return [ function($inval) {
          var $nextval;

          $nextval = $this.next($inval);
          $.Function(function() {
            return [ function() {
              return $nextval.notNil().and($.Function(function() {
                return [ function() {
                  return $function.value($nextval, $inval);
                } ];
              }));
            } ];
          }).while($.Function(function() {
            return [ function() {
              $nextval = $this.next($inval);
              return $nextval;
            } ];
          }));

          return $nextval;
        } ];
      });
      $resetFunc = $.Function(function() {
        return [ function() {
          return $this.reset();
        } ];
      });

      return $(&quot;FuncStream&quot;).new($nextFunc, $resetFunc);
    }, &quot;function&quot;);

    spec.select = fn(function($function) {
      var $this = this;
      var $nextFunc, $resetFunc;

      $nextFunc = $.Function(function() {
        return [ function($inval) {
          var $nextval;

          $nextval = $this.next($inval);
          $.Function(function() {
            return [ function() {
              return $nextval.notNil().and($.Function(function() {
                return [ function() {
                  return $function.value($nextval, $inval).not();
                } ];
              }));
            } ];
          }).while($.Function(function() {
            return [ function() {
              $nextval = $this.next($inval);
              return $nextval;
            } ];
          }));

          return $nextval;
        } ];
      });
      $resetFunc = $.Function(function() {
        return [ function() {
          return $this.reset();
        } ];
      });

      return $(&quot;FuncStream&quot;).new($nextFunc, $resetFunc);
    }, &quot;function&quot;);

    spec.dot = fn(function($function, $stream) {
      var $this = this;

      return $(&quot;FuncStream&quot;).new($.Function(function() {
        return [ function($inval) {
          var $x, $y;

          $x = $this.next($inval);
          $y = $stream.next($inval);

          if ($x !== $nil &amp;&amp; $y !== $nil) {
            return $function.value($x, $y, $inval);
          }

          return $nil;
        } ];
      }), $.Function(function() {
        return [ function() {
          $this.reset();
          return $stream.reset();
        } ];
      }));
    }, &quot;function; stream&quot;);

    spec.interlace = fn(function($function, $stream) {
      var $this = this;
      var $nextx, $nexty;

      $nextx = this.next();
      $nexty = $stream.next();

      return $(&quot;FuncStream&quot;).new($.Function(function() {
        return [ function($inval) {
          var $val;

          if ($nextx === $nil) {
            if ($nexty === $nil) {
              return $nil;
            } else {
              $val = $nexty;
              $nexty = $stream.next($inval);
              return $val;
            }
          } else {
            if ($nexty === $nil ||
              $function.value($nextx, $nexty, $inval).__bool__()) {
              $val   = $nextx;
              $nextx = $this.next($inval);
              return $val;
            } else {
              $val   = $nexty;
              $nexty = $stream.next($inval);
              return $val;
            }
          }
        } ];
      }), $.Function(function() {
        return [ function() {
          $this.reset();
          $stream.reset();
          $nextx = $this.next();
          $nexty = $stream.next();
          return $nexty;
        } ];
      }));
    }, &quot;function; stream&quot;);

    spec[&quot;++&quot;] = function($stream) {
      return this.appendStream($stream);
    };

    spec.appendStream = fn(function($stream) {
      var $this = this;
      var $reset;

      $reset = $false;
      return $(&quot;Routine&quot;).new($.Function(function() {
        var $inval;
        return [ function(_arg0) {
          $inval = _arg0;
          if ($reset.__bool__()) {
            $this.reset();
            $stream.reset();
          }
          $reset = $true;
          $inval = $this.embedInStream($inval);
          return $inval;
        },
        function() {
          return $stream.embedInStream($inval);
        } ];
      }));
    }, &quot;stream&quot;);

    spec.collate = fn(function($stream) {
      return this.interlace($.Function(function() {
        return [ function($x, $y) {
          return $x.$(&quot;&lt;&quot;, [ $y ]);
        } ];
      }), $stream);
    }, &quot;stream&quot;);

    spec[&quot;&lt;&gt;&quot;] = function($obj) {
      return $(&quot;Pchain&quot;).new(this, $obj).asStream();
    };

    spec.composeUnaryOp = fn(function($argSelector) {
      return $(&quot;UnaryOpStream&quot;).new($argSelector, this);
    }, &quot;argSelector&quot;);

    spec.composeBinaryOp = fn(function($argSelector, $argStream, $adverb) {
      if ($adverb === $nil) {
        return $(&quot;BinaryOpStream&quot;).new(
          $argSelector, this, $argStream.asStream()
        );
      }
      if ($adverb.__sym__() === &quot;x&quot;) {
        return $(&quot;BinaryOpXStream&quot;).new(
          $argSelector, this, $argStream.asStream()
        );
      }

      return $nil;
    }, &quot;argSelector; argStream; adverb&quot;);

    spec.reverseComposeBinaryOp = fn(function($argSelector, $argStream, $adverb) {
      if ($adverb === $nil) {
        return $(&quot;BinaryOpStream&quot;).new(
          $argSelector, $argStream.asStream(), this
        );
      }
      if ($adverb.__sym__() === &quot;x&quot;) {
        return $(&quot;BinaryOpXStream&quot;).new(
          $argSelector, $argStream.asStream(), this
        );
      }

      return $nil;
    }, &quot;argSelector; argStream; adverb&quot;);

    spec.composeNAryOp = fn(function($argSelector, $anArgList) {
      return $(&quot;NAryOpStream&quot;).new(
        $argSelector, this, $anArgList.collect($.Function(function() {
          return [ function($_) {
            return $_.asStream();
          } ];
        }))
      );
    }, &quot;argStream; anArgList&quot;);

    spec.embedInStream = fn(function($inval) {
      var $this = this;
      var $outval;

      $.Function(function() {
        return [ function() {
          $outval = $this.value($inval);
          return $outval.notNil();
        } ];
      }).while($.Function(function() {
        return [ function() {
          $inval = $outval.yield();
          return $inval;
        } ];
      }));

      return $inval;
    }, &quot;inval&quot;);

    spec.asEventStreamPlayer = fn(function($protoEvent) {
      return $(&quot;EventStreamPlayer&quot;).new(this, $protoEvent);
    }, &quot;protoEvent&quot;);

    spec.play = fn(function($clock, $quant) {
      if ($clock === $nil) {
        $clock = $(&quot;TempoClock&quot;).default();
      }
      $clock.play(this, $quant.asQuant());
      return this;
    }, &quot;clock; quant&quot;);

    // TODO: implements trace

    spec.repeat = fn(function($repeats) {
      var $this = this;

      return $.Function(function() {
        return [ function($inval) {
          return $repeats.value($inval).do($.Function(function() {
            return [ function() {
              $inval = $this.reset().embedInStream($inval);
              return $inval;
            } ];
          }));
        } ];
      }).r();
    }, &quot;repeats=inf&quot;);

  });

  klass.define(&quot;OneShotStream : Stream&quot;, function(spec, utils) {
    var $nil = utils.$nil;

    spec.constructor = function OneShotStream() {
      this.__super__(&quot;Stream&quot;);
      this._once = true;
    };

    spec.$new = function($value) {
      return this._newCopyArgs({
        value: $value
      });
    };

    spec.next = function() {
      if (this._once) {
        this._once = false;
        return this._$value;
      }
      return $nil;
    };

    spec.reset = function() {
      this._once = true;
      return this;
    };

    // TODO: implements storeArgs
  });

  // EmbedOnce

  klass.define(&quot;FuncStream : Stream&quot;, function(spec, utils) {
    var $nil = utils.$nil;

    spec.constructor = function SCFuncStream() {
      this.__super__(&quot;Stream&quot;);
    };

    spec.envir = function() {
      return this._$envir;
    };

    spec.envir_ = function($value) {
      this._$envir = $value || /* istanbul ignore next */ $nil;
      return this;
    };

    spec.$new = function($nextFunc, $resetFunc) {
      return this._newCopyArgs({
        nextFunc : $nextFunc,
        resetFunc: $resetFunc,
        envir    : sc.lang.main.$currentEnv
      });
    };

    spec.next = fn(function($inval) {
      var $this = this;
      return this._$envir.use($.Function(function() {
        return [ function() {
          return $this._$nextFunc.value($inval).processRest($inval);
        } ];
      }));
    }, &quot;inval&quot;);

    spec.reset = function() {
      var $this = this;
      return this._$envir.use($.Function(function() {
        return [ function() {
          return $this._$resetFunc.value();
        } ];
      }));
    };

    // TODO: implements storeArgs

  });

  // StreamClutch
  // CleanupStream

  klass.define(&quot;PauseStream : Stream&quot;, function(spec) {
    spec.constructor = function SCPauseStream() {
      this.__super__(&quot;Stream&quot;);
    };

    // TODO: implements stream
    // TODO: implements originalStream
    // TODO: implements clock
    // TODO: implements nextBeat
    // TODO: implements streamHasEnded
    // TODO: implements streamHasEnded_

    // TODO: implements isPlaying
    // TODO: implements play
    // TODO: implements reset
    // TODO: implements stop
    // TODO: implements prStop
    // TODO: implements removedFromScheduler
    // TODO: implements streamError
    // TODO: implements wasStopped
    // TODO: implements canPause
    // TODO: implements pause
    // TODO: implements resume
    // TODO: implements refresh
    // TODO: implements start
    // TODO: implements stream_
    // TODO: implements next
    // TODO: implements awake
    // TODO: implements threadPlayer
  });

  klass.define(&quot;Task : PauseStream&quot;, function(spec) {
    spec.constructor = function SCTask() {
      this.__super__(&quot;PauseStream&quot;);
    };

    // TODO: implements storeArgs
  });

});</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
